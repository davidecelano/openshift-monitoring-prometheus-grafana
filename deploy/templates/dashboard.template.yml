apiVersion: v1
kind: Template
labels:
  template: dedalus-grafana-template
metadata:
  annotations:
    description: |-
      Grafana dashboard definition about the JVM without persistent storage.
      For more information about using this template, including OpenShift considerations, see https://github.com/dedalus-enterprise-architect/grafana-resources/blob/master/README.md.
    iconClass: icon-d4center
    tags: dedalus-grafana,dedalus
  name: dedalus-grafana
objects:
# :::
# ::: Grafana Data Source
# :::
- apiVersion: integreatly.org/v1alpha1
  kind: GrafanaDataSource
  metadata:
    name: prometheus-grafana-ds
  spec:
    datasources:
      - access: proxy
        editable: true
        isDefault: true
        jsonData:
          httpHeaderName1: Authorization
          timeInterval: 5s
          tlsSkipVerify: true
        name: Prometheus
        secureJsonData:
          httpHeaderValue1: >-
            Bearer ${TOKEN_BEARER}
        type: prometheus
        url: '${THANOS_QUERIER_URL}'
    name: prometheus-grafana-ds.yml
# :::
# ::: Grafana Dashboard: JVM
# :::
- apiVersion: integreatly.org/v1alpha1
  kind: GrafanaDashboard
  metadata:
    name: jvm-dashboard
    labels:
      app: grafana
  spec:
    # plugins:
    #   - name: grafana-piechart-panel
    #     version: 1.3.9
    customFolderName: "Dedalus Dashboards"
    url: https://raw.githubusercontent.com/dedalus-enterprise-architect/grafana-resources/master/deploy/dashboards/grafana.dashboard.tomcat.json
    datasources:
      - inputName: "DS_PROMETHEUS"
        datasourceName: "Prometheus"
parameters:
# - name: CPU_REQUEST
#   displayName: Container CPU Request
#   description: Minimum amount of millicore of CPU the container can use.
#   required: false
#   value: 100m
# - name: MEMORY_REQUEST
#   displayName: Container Memory Request
#   description: Minimum amount of memory the container can use for JAVA application.
#   required: false
#   value: 600Mi
# - name: CPU_LIMIT
#   displayName: Container CPU Limit
#   description: Maximum amount of millicore of CPU the container can use.
#   required: false
#   value: 2000m
# - name: MEMORY_LIMIT
#   displayName: Container Memory Limit
#   description: Maximum amount of memory the container can use for JAVA application.
#   required: false
#   value: 2400Mi
- name: TOKEN_BEARER
  displayName: Openshift Token Bearer
  description: Type the Openshift Token
  required: true
  value:
- name: THANOS_QUERIER_URL
  displayName: Thanos Querier URL
  description: Type the Thanos querier URL (https://thanos-querier.namespace.svc.cluster.local:9091)
  required: true
  value: